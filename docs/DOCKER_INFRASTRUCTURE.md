# DOCKER_INFRASTRUCTURE.md

## Purpose

This document defines the **only allowed execution environment** for the project.

All services **MUST run inside Docker containers on the remote server**.
Local machines (Mac / IDE / AI Agent) are **code-only environments**.

If this document is followed, execution, testing, and debugging will never leak to local systems.

---

## Execution Law (Non‑Negotiable)

* ❌ No code execution on local machines

* ❌ No local database instances

* ❌ No local Docker runtime usage

* ✅ All execution happens on remote server

* ✅ Domain-based access via [https://grayhawks.com](https://grayhawks.com)

* ✅ Docker is the only runtime

Violation of this rule = architectural breach

---

## Remote Server Specification

* OS: Debian 13
* Docker: Installed
* Docker Compose: Installed
* SSH Access:

```bash
ssh root@grayhawks.com -p 25920
```

---

## Project Directory Structure (Remote)

```
/opt/bjdms/
├── docker-compose.yml
├── .env
├── services/
│   ├── api/
│   ├── worker/
│   └── nginx/
├── volumes/
│   ├── postgres/
│   └── redis/
└── logs/
```

---

## Core Containers

### 1. API Service

* Technology: (defined later)
* Exposes: internal port only
* Never binds directly to public internet

---

### 2. PostgreSQL

* Version: 16
* Data stored in named Docker volume
* No external access

---

### 3. Redis

* Used for:

  * JWT blacklist
  * Rate limiting
  * Caching

---

### 4. NGINX (Reverse Proxy)

* Only public-facing container
* Handles:

  * HTTPS
  * Domain routing
  * Service isolation

---

## Domain Routing Rules

* [https://grayhawks.com](https://grayhawks.com) → NGINX
* NGINX → api service
* Temporary preview paths allowed:

```
https://grayhawks.com/dev/*
```

---

## Environment Variables Policy

* `.env` exists only on remote server
* Never committed to git
* Never generated by AI agents

---

## Allowed Operations by AI Agents

| Operation     | Local | Remote |
| ------------- | ----- | ------ |
| Write code    | ✅     | ❌      |
| Modify docs   | ✅     | ❌      |
| Build image   | ❌     | ✅      |
| Run service   | ❌     | ✅      |
| Execute tests | ❌     | ✅      |

---

## Deployment Flow (Strict)

1. AI Agent writes code locally
2. Code pushed to repository
3. Human deploys to remote server
4. Docker containers rebuilt
5. Services accessible via grayhawks.com

---

## Security Guardrails

* Root SSH only from trusted IPs
* Docker socket never exposed
* No container runs as root (except nginx bootstrap)

---

## Final Note

এই ডকুমেন্ট ভাঙলে সিস্টেম ভাঙবে।
এই ডকুমেন্ট ঠিক থাকলে – যত বড়ই হোক – সিস্টেম স্থিতিশীল থাকবে।

